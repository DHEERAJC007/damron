
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Bo Zhao, Benji Antolin">
  <title>Local Changes</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Oswald&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css"> -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/case2.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
  <script src="https://unpkg.com/d3@5/dist/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v5.min.js"></script> -->
  <!-- <script src="https://dc-js.github.io/dc.js/js/crossfilter.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/dc.js"></script> -->
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <!-- <script src="js/leaflet.heat.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script> -->
</head>

<body>
  <header>
    <div class="collapse bg-dark" id="navbarHeader">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-8 col-md-7 py-4">
            <h4 class="text-white">About</h4>
            <p class="text-muted">This website utilizes web geovisualization tools to
              visualize four questions that CWS is interested in
              analyzing. Each application contains interactive map
              elements and charts. Explore the categories below to
              to learn more.</p>
          </div>
          <div class="col-sm-4 offset-md-1 py-4">
            <h4 class="text-white">Contact</h4>
            <ul class="list-unstyled">
              <li><a href="#" class="text-white">Follow on Twitter</a></li>
              <li><a href="#" class="text-white">Like on Facebook</a></li>
              <li><a href="#" class="text-white">Email me</a></li>
            </ul>
          </div>
        </div>
        <div class="navbar-expand-md navbar-dark bg-dark shadow-sm">
          <ul class="navbar-nav mr-auto">

            <li class="nav-item">
              <a class="nav-link" href="case1.html">Flood compliants</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="case2.html">Local Changes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="case3.html">Projec Imapcts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="case4.html">Beaver Activities</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="navbar navbar-dark bg-dark shadow-sm">
      <div class="container-fluid d-flex justify-content-between">
        <a href="index.html" class="navbar-brand d-flex align-items-center">
          <img src="img/navbar.png" class="img-responsive" height="30"></img>
          <strong>Seattle</strong>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </header>
  <main>
    <div class="loader"></div>
    <div id="upper_panel" class="d-flex align-items-start flex-column">
      <span id="year">1965</span>
      <div id="timeline-chart"></div>
    </div>
    <!-- <div id="info" class="d-flex flex-column">
      <h4><i class="fas fa-users pop"></i> Local Changes </h4>
      <div class="row col-md-12">
        <div class="col-md-7 align-items-center">
          <span>Land Use</span>
          <label id="luSwitcher" class="switch">
            <input type="checkbox">
            <span class="slider round"></span>
          </label>
        </div>
        <div class="col-md-5 align-items-center">
          <span>Population</span>
          <label id="popSwitcher" class="switch">
            <input type="checkbox">
            <span class="slider round"></span>
          </label>
        </div>
      </div>
      <div class="row col-md-12">
        <div class="col-md-8 legend">
          <i style="background: #d0a750; opacity: 0.5"></i>
          <p>Single Family Residential</p>
          <i style="background: #f6da31; opacity: 0.5"></i>
          <p>Multi-Family Residential</p>
          <i style="background: #ff9c67; opacity: 0.5"></i>
          <p>Mixed-Use Residential</p>
          <i style="background: #ed87ae; opacity: 0.5"></i>
          <p>Rural</p>
          <i style="background: #b7d94b; opacity: 0.5"></i>
          <p>Parks and Open Space</p>
          <i style="background: #d390cd; opacity: 0.5"></i>
          <p>Public Facilities</p>
          <i style="background: #939fcf; opacity: 0.5"></i>
          <p>Mixed-Use Employment</p>
          <i style="background: #b3b3b3; opacity: 0.5"></i>
          <p>Industrial</p>
          <i style="background: #d7bf9e; opacity: 0.5"></i>
          <p>Commercial</p>
          <i style="background: #f5cb72; opacity: 0.5"></i>
          <p>Future Urban Development</p>
        </div>
        <div class="col-md-4 legend">
          <i style="background:#ffffcc; opacity: 0.5"></i>
          <p>
            < 500</p> <i style="background:#ffea9a; opacity: 0.5"></i>
              <p>500-1000</p>
              <i style="background:#fece6a; opacity: 0.5"></i>
              <p>1001-1500</p>
              <i style="background:#fea245; opacity: 0.5"></i>
              <p>1501-2000</p>
              <i style="background:#fc6932; opacity: 0.5"></i>
              <p>2001-2500</p>
              <i style="background: #ea2920; opacity: 0.5"></i>
              <p>2501-3000</p>
              <i style="background:#c20425; opacity: 0.5"></i>
              <p>3001-3500</p>
              <i style="background: #800026; opacity: 0.5"></i>
              <p>> 3500</p>
        </div>
      </div>
      <hr>
      <div id="wq"></div>
    </div> -->
    <div id="map"></div>
  </main>

  <script>



    $(window).ready(function() {
      $('.loader').fadeOut("slow");
    });


    // var createLabelIcon = function(labelClass, labelText) {
    //   return L.divIcon({
    //     className: labelClass,
    //     html: labelText
    //   })
    // }


    var mymap = L.map('map', {
      center: [45.448, -122.765],
      zoomControl: false,
      zoom: 13,
      maxZoom: 16,
      minZoom: 12
    });

    new L.Control.Zoom({
      position: 'topright'
    }).addTo(mymap);



    var gray = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}@2x.png').addTo(mymap);
    var streets = L.tileLayer('http://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}@2x.png');
    var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    var baseLayers = {
      'Grayscale': gray,
      'Streets': streets,
      'Satellite': satellite
    }


    var mGroup = L.layerGroup().addTo(mymap);
    var wGroup = L.layerGroup().addTo(mymap);
    var mLayers, wLayers;
    var chart, chart2;

    var zoningColors = chroma.scale('Set2').mode('lch').colors(11);
    var acsColors = chroma.scale('YlOrRd').colors(8);



    var overlays = {
      "<span>Men</span>": mGroup,
      "<span>Women</span>": wGroup,
      "<span>Place Names</span>": L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}@2x.png').addTo(mymap)
    }

    L.control.layers(baseLayers, overlays, {
      collapsed: false
    }).addTo(mymap);


    Promise.all([
      d3.json("assets/seattle-m-1965.geojson"),
      d3.json("assets/seattle-m-1975.geojson"),
      d3.json("assets/seattle-m-1983.geojson"),
      d3.json("assets/seattle-m-1995.geojson"),
      d3.json("assets/seattle-m-2005.geojson"),
      d3.json("assets/seattle-m-2014.geojson"),
      d3.json("assets/seattle-w-1995.geojson"),
      d3.json("assets/seattle-w-2005.geojson"),
      d3.json("assets/seattle-w-2009.geojson"),
      d3.json("assets/seattle-w-2012.geojson"),
      d3.json("assets/seattle-w-2014.geojson")
    ]).then(function(datasets) {


      mLayers = {
        1965: L.geoJSON(datasets[0]),
        1975: L.geoJSON(datasets[1]),
        1983: L.geoJSON(datasets[2]),
        1995: L.geoJSON(datasets[3]),
        2005: L.geoJSON(datasets[4]),
        2014: L.geoJSON(datasets[5])
      };

      wLayers = {
        1995: L.geoJSON(datasets[6]),
        2005: L.geoJSON(datasets[7]),
        2009: L.geoJSON(datasets[8]),
        2012: L.geoJSON(datasets[9]),
        2014: L.geoJSON(datasets[10])
      };


      mLayers[2010].addTo(mGroup);





      // the charts

      // var t = ["t"];
      // var tss = ["Total Suspended Solids (mg/L)"];
      // var tp = ["Total Phosphorus (mg/L)"];
      // datasets[0].forEach(function(d) {
      //   t.push(new Date(d["t"]))
      //   tss.push(+d["tss"] / 1000.0)
      //   tp.push((+d["tp"] / 10).toFixed(2))
      // });


      // chart = c3.generate({
      //   size: {
      //     width: 480
      //   },
      //   data: {
      //     x: "t",
      //     y: "tss",
      //     y2: "tp",
      //     columns: [t, tss, tp],
      //     type: 'spline',
      //     axes: {
      //       tss: 'y',
      //       tp: 'y2'
      //     }
      //   },
      //   axis: {
      //     x: {
      //       type: "timeseries",
      //       tick: {
      //         format: "%b %Y",
      //         fit: true,
      //         culling: {
      //           max: 6
      //         }
      //       }
      //     },
      //     y: {
      //       label: {
      //         text: 'Total Suspended Solids (g/L)',
      //         position: 'outer-middle'
      //       }
      //     },
      //     y2: {
      //       show: true,
      //       label: {
      //         text: 'Total Phosphorus (mg/L)',
      //         position: 'outer-middle'
      //       },
      //       max: .3,
      //       min: 0
      //     },
      //   },
      //   point: {
      //     r: 0,
      //     focus: {
      //       expand: {
      //         r: 2
      //       }
      //     }
      //   },
      //   zoom: {
      //     // rescale: true,
      //     enabled: false,
      //     type: "scroll",
      //     // onzoom: function(d) {
      //     //   tt(d);
      //     // }
      //   },
      //   tooltip: {
      //     linked: true,
      //   },
      //   legend: {
      //     position: 'inset',
      //     inset: {
      //       anchor: "top-right",
      //       y: -10,
      //     },
      //   },
      //   bindto: "#wq"
      // });
      //

      var t = ["t"];
      var totpop = ["Population"];

      datasets[1].forEach(function(d) {
        t.push(d["t"])
        totpop.push(+d["totpop"]) //- 217000
      });


      chart2 = c3.generate({
        size: {
          height: 80,
          width: 480
        },
        data: {
          x: "t",
          columns: [t, totpop],
          // onclick: annualUpdate,
          onmouseover: annualUpdate,
          type: 'area',
          labels: false,
          colors: {
            Population: 'rgba(0, 0, 0, 0.5)',
          }
        },
        area: {
          zerobased: false
        },
        tooltip: {
          show: true
        },
        legend: {
          show: false
        },
        point: {
          r: 5,
          focus: {
            expand: {
              r: 15
            }
          }
        },
        // zoom: {
        //   enabled: true,
        //   onzoomend: function(d) {
        //
        //   }
        //},
        bindto: "#timeline-chart"
      });

      //  $($($("#timeline-chart svg").children()[1]).children()[5]).hide();
      $($($("#timeline-chart svg").children()[1]).children()[6]).hide();


    });

    /////////////////////////

    function setColorZoning(zone) {
      var id = 0;
      if (zone == "FUD") {
        id = 8;
      } else if (zone == "COM") {
        id = 9;
      } else if (zone == "IND") {
        id = 10;
      } else if (zone == "MFR") {
        id = 7;
      } else if (zone == "MUE") {
        id = 3;
      } else if (zone == "MUR") {
        id = 5;
      } else if (zone == "PF") {
        id = 4;
      } else if (zone == "POS") {
        id = 6;
      } else if (zone == "RUR") {
        id = 2;
      } else if (zone == "SFR") {
        id = 1;
      } else {
        id = 0;
      }
      return zoningColors[id];
    }

    function styleZoning(feature) {
      return {
        fillColor: setColorZoning(feature.properties.ZONEGEN_CL),
        fillOpacity: 0.4,
        weight: 0,
        opacity: 1,
        color: '#b4b4b4',
        dashArray: '4'
      };
    }


    function setColorACS(population) {
      var id = 0;
      if (population > 3500) {
        id = 7;
      } else if (population > 3000 && population <= 3500) {
        id = 6;
      } else if (population > 2500 && population <= 3000) {
        id = 5;
      } else if (population > 2000 && population <= 2500) {
        id = 4;
      } else if (population > 1500 && population <= 2000) {
        id = 3;
      } else if (population > 1000 && population <= 1500) {
        id = 2;
      } else if (population > 500 && population <= 1000) {
        id = 1;
      } else {
        id = 0;
      }
      return acsColors[id];
    }

    // 7. Set style function that sets fill color.md property equal to cell tower density
    function styleACS(feature) {
      return {
        fillColor: setColorACS(feature.properties.totpop),
        fillOpacity: 0.5,
        weight: 1,
        opacity: 1,
        color: '#b4b4b4',
        dashArray: '4'
      };
    }


    function stream_style(feature) {
      var w = 0.5;
      if (feature.properties.StreamClas == "Perennial") {
        w = 1;
      } else {
        w = 0.5;
      }
      return {
        opacity: 0.4,
        weight: w
      };
    };

    function highlightFeature(e) {
      var layer = e.target;
    }

    ///////////////////////////////////

    $(".leaflet-control-attribution")
      .css("bottom", "60px")
      .css("background-color", "transparent")
      .html("Supported by <a href='http://geoviz.ceoas.oregonstate.edu'> GeoViz Lab @ Oregon State University </a>");

    function tt(d) {
      var currentDate = new Date(d.x.toString());
      var currentYear = currentDate.getFullYear() + 1;
      $("#year").text(d.x);

      var start = currentYear.toString() + "-01-01";
      var end = currentYear.toString() + "-12-31";
      var ticks = [];
      start = new Date(start.toString());
      end = new Date(end.toString());

      s = start.getTime();
      e = end.getTime();
      breaks = 5;
      interval = Math.floor(e - s) / breaks
      ticks = [];
      for (var j = 0; j < breaks; j++) {
        ticks.push(new Date(s + interval * j))
      }
      ticks.push(end);

      chart.internal.config.axis_x_tick_values = ticks;
      chart.flush();

    }


    function annualUpdate(d) {
      var currentDate = new Date(d.x.toString());
      var currentYear = currentDate.getFullYear() + 1;
      $("#year").text(d.x);

      var start = currentYear.toString() + "-01-01";
      var end = currentYear.toString() + "-12-31";





      var ticks = [];
      start = new Date(start.toString());
      end = new Date(end.toString());

      s = start.getTime();
      e = end.getTime();
      breaks = 5;
      interval = Math.floor(e - s) / breaks
      ticks = [];
      for (var j = 0; j < breaks; j++) {
        ticks.push(new Date(s + interval * j))
      }
      ticks.push(end);

      chart.internal.config.axis_x_tick_values = ticks;
      // chart.flush();




      chart.zoom([new Date(start.toString()), new Date(end.toString())]);







      if ($("#luSwitcher input:checked").val() === "on") {
        luGroup.clearLayers();
        zoneLayers[currentYear].addTo(luGroup);
      } else {
        luGroup.clearLayers();
      }


      if ($("#popSwitcher input:checked").val() === "on") {
        popGroup.clearLayers();
        ascLayers[currentYear].addTo(popGroup);
      } else {
        popGroup.clearLayers();
      }
    }

    $("#popSwitcher input").on("click", function() {
      if ($("#popSwitcher input:checked").val() === "on") {} else {
        popGroup.clearLayers();
      }
    })


    $("#luSwitcher input").on("click", function() {
      if ($("#luSwitcher input:checked").val() === "on") {} else {
        luGroup.clearLayers();
      }
    });


    $("#luSwitcher").click();
  </script>
</body>

</html>
