<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Bo Zhao">
  <title>Damron Guide: Seattle</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Oswald&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/seattle.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
  <script src="https://unpkg.com/d3@5/dist/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.js"></script>
  <!-- <script src="https://dc-js.github.io/dc.js/js/crossfilter.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/dc.js"></script> -->
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="js/leaflet.heat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>

<body>
  <header>
    <div class="collapse bg-dark" id="navbarHeader">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-8 col-md-7 py-4">
            <h4 class="text-white">About</h4>
            <p class="text-muted">This website utilizes web geovisualization tools to
              visualize XXXX. Each application contains interactive map
              elements and charts. Explore the categories below to
              to learn more.</p>
          </div>
          <div class="col-sm-4 offset-md-1 py-4">
            <h4 class="text-white">Contact</h4>
            <ul class="list-unstyled">
              <li><a href="#" class="text-white">Follow on Twitter</a></li>
              <li><a href="#" class="text-white">Like on Facebook</a></li>
              <li><a href="#" class="text-white">Email me</a></li>
            </ul>
          </div>
        </div>
        <div class="navbar-expand-md navbar-dark bg-dark shadow-sm">
          <ul class="navbar-nav mr-auto">

            <li class="nav-item">
              <a class="nav-link" href="seattle.html">Seattle</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="atlanta.html">Atlanta</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="omaha.html">Omaha</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="worcester.html">Worcester</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="navbar navbar-dark bg-dark shadow-sm">
      <div class="container-fluid d-flex justify-content-between">
        <a href="index.html" class="navbar-brand d-flex align-items-center">
          <img src="img/logo.png" class="img-responsive" height="30"></img>
          <strong class="rainbow">&nbsp;&nbsp;&nbsp;&nbsp;Damron Guide: Seattle</strong>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </header>
  <main>
    <div class="loader"></div>
    <div id="upper_panel" class="d-flex align-items-start flex-column">
      <span id="year">1965</span>
      <div id="timeline-chart"></div>
    </div>

    <div id="info" class="d-flex flex-column">
      <h4><i class="fas fa-users pop"></i> Seattle </h4>

    </div>
    <div id="map"></div>
  </main>

  <script>

  // 1. heatmap
  // 2. add data to chart.
    $(window).ready(function() {
      $('.loader').fadeOut("slow");
    });


    var mymap = L.map('map', {
      center: [47.609, -122.342],
      zoomControl: false,
      zoom: 13,
      maxZoom: 18,
      minZoom: 11
    });

    new L.Control.Zoom({
      position: 'topright'
    }).addTo(mymap);


    // var dark = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png').addTo(mymap);
    var gray = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}@2x.png').addTo(mymap);
    var streets = L.tileLayer('http://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}@2x.png');
    var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    var baseLayers = {
      // 'Dark': dark,
      'Gray': gray,
      'Streets': streets,
      'Satellite': satellite
    }


    var mGroup = L.layerGroup().addTo(mymap);
    var wGroup = L.layerGroup().addTo(mymap);
    var mLayers, wLayers;
    var chart, chart2;

    var zoningColors = chroma.scale('Set2').mode('lch').colors(11);
    var acsColors = chroma.scale('YlOrRd').colors(8);


    var overlays = {
      "<span style='color: rgb(0,40,255)'>Men</span>": mGroup,
      "<span style='color: rgb(255,0,255)'>Women</span>": wGroup,
      "<span>Place Names</span>": L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}@2x.png').addTo(mymap)
    }

    L.control.layers(baseLayers, overlays, {
      collapsed: false
    }).addTo(mymap);


    Promise.all([
      d3.json("assets/seattle-m-1965.geojson"),
      d3.json("assets/seattle-m-1975.geojson"),
      d3.json("assets/seattle-m-1983.geojson"),
      d3.json("assets/seattle-m-1995.geojson"),
      d3.json("assets/seattle-m-2005.geojson"),
      d3.json("assets/seattle-m-2014.geojson"),
      d3.json("assets/seattle-w-1995.geojson"),
      d3.json("assets/seattle-w-2005.geojson"),
      d3.json("assets/seattle-w-2009.geojson"),
      d3.json("assets/seattle-w-2012.geojson"),
      d3.json("assets/seattle-w-2014.geojson"),
      d3.csv('assets/seattle-pop.csv'),
    ]).then(function(datasets) {


      mLayers = {
        1965: L.geoJSON(datasets[0], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        1975: L.geoJSON(datasets[1], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        1983: L.geoJSON(datasets[2], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        1995: L.geoJSON(datasets[3], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        2005: L.geoJSON(datasets[4], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        2009: L.geoJSON(datasets[4], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        2012: L.geoJSON(datasets[4], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }}),
        2014: L.geoJSON(datasets[5], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs men glow-effect'})});
        }})
      };

      wLayers = {
        1995: L.geoJSON(datasets[6], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs women glow-effect'})});
        }}),
        2005: L.geoJSON(datasets[7], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs women glow-effect'})});
        }}),
        2009: L.geoJSON(datasets[8], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs women glow-effect'})});
        }}),
        2012: L.geoJSON(datasets[9], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs women glow-effect'})});
        }}),
        2014: L.geoJSON(datasets[10], {
          onEachFeature: function (feature, layer) {
            layer.bindPopup("<h4>" + feature.properties.Name + "</h4>");
          },
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.divIcon({className: 'fas fa-circle fa-xs women glow-effect'})});
        }})
      };

      mLayers[1965].addTo(mGroup);





      // the charts

      // var t = ["t"];
      // var tss = ["Total Suspended Solids (mg/L)"];
      // var tp = ["Total Phosphorus (mg/L)"];
      // datasets[0].forEach(function(d) {
      //   t.push(new Date(d["t"]))
      //   tss.push(+d["tss"] / 1000.0)
      //   tp.push((+d["tp"] / 10).toFixed(2))
      // });


      // chart = c3.generate({
      //   size: {
      //     width: 480
      //   },
      //   data: {
      //     x: "t",
      //     y: "tss",
      //     y2: "tp",
      //     columns: [t, tss, tp],
      //     type: 'spline',
      //     axes: {
      //       tss: 'y',
      //       tp: 'y2'
      //     }
      //   },
      //   axis: {
      //     x: {
      //       type: "timeseries",
      //       tick: {
      //         format: "%b %Y",
      //         fit: true,
      //         culling: {
      //           max: 6
      //         }
      //       }
      //     },
      //     y: {
      //       label: {
      //         text: 'Total Suspended Solids (g/L)',
      //         position: 'outer-middle'
      //       }
      //     },
      //     y2: {
      //       show: true,
      //       label: {
      //         text: 'Total Phosphorus (mg/L)',
      //         position: 'outer-middle'
      //       },
      //       max: .3,
      //       min: 0
      //     },
      //   },
      //   point: {
      //     r: 0,
      //     focus: {
      //       expand: {
      //         r: 2
      //       }
      //     }
      //   },
      //   zoom: {
      //     // rescale: true,
      //     enabled: false,
      //     type: "scroll",
      //     // onzoom: function(d) {
      //     //   tt(d);
      //     // }
      //   },
      //   tooltip: {
      //     linked: true,
      //   },
      //   legend: {
      //     position: 'inset',
      //     inset: {
      //       anchor: "top-right",
      //       y: -10,
      //     },
      //   },
      //   bindto: "#wq"
      // });
      //

      var t = ["t"];
      var mPop = ["# Men"];
      var wPop = ["# Women"];

      datasets[11].forEach(function(d) {
        t.push(d["t"])
        mPop.push(+d["m"])
        wPop.push(+d["w"])
      });


      chart2 = c3.generate({
        size: {
          height: 80,
          width: 480
        },
        data: {
          x: "t",
          columns: [t, mPop, wPop],
          onmouseover: annualUpdate,
          type: 'area',
          labels: false,
          colors: {
            "# Women": 'rgba(255, 0, 255, .6)',
            "# Men": 'rgba(0, 40, 255, .6)'
          },
          groups: [
            ["# Women", "# Men"]
          ]
        },
        area: {
          zerobased: true
        },
        tooltip: {
          show: false
        },
        legend: {
          show: false
        },
        point: {
          r: 1,
          focus: {
            expand: {
              r: 4
            }
          }
        },
        bindto: "#timeline-chart"
      });

      $($($("#timeline-chart svg").children()[1]).children()[6]).hide();


    });




    /////////////////////////
    //
    // function setColorZoning(zone) {
    //   var id = 0;
    //   if (zone == "FUD") {
    //     id = 8;
    //   } else if (zone == "COM") {
    //     id = 9;
    //   } else if (zone == "IND") {
    //     id = 10;
    //   } else if (zone == "MFR") {
    //     id = 7;
    //   } else if (zone == "MUE") {
    //     id = 3;
    //   } else if (zone == "MUR") {
    //     id = 5;
    //   } else if (zone == "PF") {
    //     id = 4;
    //   } else if (zone == "POS") {
    //     id = 6;
    //   } else if (zone == "RUR") {
    //     id = 2;
    //   } else if (zone == "SFR") {
    //     id = 1;
    //   } else {
    //     id = 0;
    //   }
    //   return zoningColors[id];
    // }
    //
    // function styleZoning(feature) {
    //   return {
    //     fillColor: setColorZoning(feature.properties.ZONEGEN_CL),
    //     fillOpacity: 0.4,
    //     weight: 0,
    //     opacity: 1,
    //     color: '#b4b4b4',
    //     dashArray: '4'
    //   };
    // }
    //
    //
    // function setColorACS(population) {
    //   var id = 0;
    //   if (population > 3500) {
    //     id = 7;
    //   } else if (population > 3000 && population <= 3500) {
    //     id = 6;
    //   } else if (population > 2500 && population <= 3000) {
    //     id = 5;
    //   } else if (population > 2000 && population <= 2500) {
    //     id = 4;
    //   } else if (population > 1500 && population <= 2000) {
    //     id = 3;
    //   } else if (population > 1000 && population <= 1500) {
    //     id = 2;
    //   } else if (population > 500 && population <= 1000) {
    //     id = 1;
    //   } else {
    //     id = 0;
    //   }
    //   return acsColors[id];
    // }
    //
    // // 7. Set style function that sets fill color.md property equal to cell tower density
    // function styleACS(feature) {
    //   return {
    //     fillColor: setColorACS(feature.properties.totpop),
    //     fillOpacity: 0.5,
    //     weight: 1,
    //     opacity: 1,
    //     color: '#b4b4b4',
    //     dashArray: '4'
    //   };
    // }
    //
    //
    // function stream_style(feature) {
    //   var w = 0.5;
    //   if (feature.properties.StreamClas == "Perennial") {
    //     w = 1;
    //   } else {
    //     w = 0.5;
    //   }
    //   return {
    //     opacity: 0.4,
    //     weight: w
    //   };
    // };
    //
    // function highlightFeature(e) {
    //   var layer = e.target;
    // }

    ///////////////////////////////////

    $(".leaflet-control-attribution")
      .css("bottom", "60px")
      .css("background-color", "transparent")
      .html("Supported by <a href='https://geography.washington.edu'> Geography @ University of Washington</a>")
      .addClass("rainbow");


    function annualUpdate(d) {
      // var currentDate = new Date(d.x.toString());
      // var currentYear = currentDate.getFullYear() + 1;
      $("#year").text(d.x);


      if (mymap.hasLayer(mGroup)) {
        mGroup.clearLayers();
        mLayers[d.x].addTo(mGroup);

        $.each(mLayers[d.x]._layers, function(i,feature){
          a = 3;
        })



      } else {
        mGroup.clearLayers();
      }


      if (mymap.hasLayer(wGroup)) {
        wGroup.clearLayers();
        if (d.x == 1965 || d.x == 1975 || d.x == 1983) {} else {
          wLayers[d.x].addTo(wGroup);
        }
      } else {
        wGroup.clearLayers();
      }

    }
  </script>
</body>

</html>
